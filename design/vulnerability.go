package design

import (
	. "goa.design/goa/v3/dsl"
)

var _ = Service("vulnerabilities", func() {
	Description("The vulnerability service handles the creation and querying of security vulnerabilities.")
	HTTP(func() {
		Path("/vulnerabilities")
	})
	Method("find", func() {
		Payload(func() {
			Attribute("id", UInt64, "Unique ID of the vulnerability", func() {
				Meta("rpc:tag", "1")
			})
			Field(1, "id", UInt64, "Unique ID of the vulnerability")
			Required("id")
		})
		Result(Vulnerability)
		Error("no_match", String, "No vulnerability matched given criteria")
		HTTP(func() {
			GET("/{id}")
			Response(StatusOK)
			Response("no_match", StatusNotFound)
		})
		// GRPC describes the gRPC transport mapping.
		GRPC(func() {
			Response(CodeOK)
		})
	})

	Method("list", func() {
		Description("List all of the vulnerabilities")
		Payload(LimitPayload)
		Result(ArrayOf(Vulnerability))
		HTTP(func() {
			GET("/")
			Response(StatusOK)
			Param("limit", Int, "Limit the number of results")
		})
		// GRPC describes the gRPC transport mapping.
		GRPC(func() {
			Response(CodeOK)
		})
	})

	Method("submit", func() {
		Payload(func() {
			Attribute("title", String, "Title of the vulnerability")
			Attribute("description", String, "Description of the vulnerability")
			Attribute("exploitable", Boolean, "If the vulnerability is exploitable")
			Attribute("cvss_score", Float32, "Severity score of the vulnerability")
			Attribute("is_patchable", Boolean, "If the vulnerability is patchable")
			Attribute("is_upgradeable", Boolean, "If the vulnerability is upgradeable")
		})
		Error("no_match", String, "No vulnerability matched given criteria")
		HTTP(func() {
			POST("/")
			Response(StatusCreated)
			Response("no_match", StatusNotFound)
		})
	})
})

var Vulnerability = Type("Vulnerability", func() {
	Attribute("id", UInt64, "Unique ID of the vulnerability", func() {
		Meta("rpc:tag", "1")
		Minimum(0)
	})
	Attribute("title", String, "Title of the vulnerability", func() {
		Meta("rpc:tag", "2")
		Example("CVE-2020-10")
	})
	Attribute("description", String, "Description of the vulnerability", func() {
		Meta("rpc:tag", "3")
		Example("There is a possible out of bounds write due to a use after free.")
	})
	Attribute("exploitable", Boolean, "If the vulnerability is exploitable", func() {
		Meta("rpc:tag", "4")
	})
	Attribute("cvss_score", Float32, "Severity score of the vulnerability", func() {
		Meta("rpc:tag", "5")
		Example(4.7)
	})
	Attribute("is_patchable", Boolean, "If the vulnerability is patchable", func() {
		Meta("rpc:tag", "6")
	})
	Attribute("is_upgradeable", Boolean, "If the vulnerability is upgradeable", func() {
		Meta("rpc:tag", "7")
	})
	Required("id")
})
